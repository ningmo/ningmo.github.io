<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>追寻一颗宁静的心</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://ningmo.github.io/"/>
  <updated>2022-04-02T01:18:22.821Z</updated>
  <id>http://ningmo.github.io/</id>
  
  <author>
    <name>ningmo</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>mac下vpn转发指定流量(L2TP)</title>
    <link href="http://ningmo.github.io/2022/03/31/linux/mac_vpn_setting/"/>
    <id>http://ningmo.github.io/2022/03/31/linux/mac_vpn_setting/</id>
    <published>2022-03-31T14:01:25.000Z</published>
    <updated>2022-04-02T01:18:22.821Z</updated>
    
    <content type="html"><![CDATA[<p>在/etc/ppp/ip-up(没有则创建文件)脚本中写入转发规则</p><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 单个指定</span></span><br><span class="line">/sbin<span class="built_in">/route </span><span class="builtin-name">add</span> -net 192.168.70.11 -interface <span class="variable">$1</span>   </span><br><span class="line"><span class="comment"># 范围指定</span></span><br><span class="line">/sbin<span class="built_in">/route </span><span class="builtin-name">add</span> -net 192.168.80.0、24 -interface <span class="variable">$1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除默认路由</span></span><br><span class="line">/sbin<span class="built_in">/route </span>delete default</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加默认路由为指定的地址</span></span><br><span class="line">/sbin<span class="built_in">/route </span><span class="builtin-name">add</span><span class="built_in"> default </span>192.168.1.1</span><br></pre></td></tr></table></figure><p>增加执行权限</p><figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line">sudo chmod u+x /etc/ppp/<span class="built_in">ip</span>-<span class="meta">up</span></span><br></pre></td></tr></table></figure><p>将vpn的网络顺序设置后最后一个 降低优先级<br>辅助命令</p><figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta"># 查看路由表</span></span><br><span class="line">netstat -nr</span><br><span class="line"></span><br><span class="line"><span class="meta"># 查看dns</span></span><br><span class="line">nslookup store.chanjet.com</span><br></pre></td></tr></table></figure><p>以上内容引用自 <a href="https://pocketcloud.vip/2020/03/19/macOS%E8%AE%BE%E7%BD%AEL2TP%E7%B1%BB%E5%9E%8B%E7%9A%84VPN%E8%BD%AC%E5%8F%91%E6%8C%87%E5%AE%9A%E7%9A%84%E6%B5%81%E9%87%8F/" target="_blank" rel="noopener">macOS设置L2TP类型的VPN转发指定的流量</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在/etc/ppp/ip-up(没有则创建文件)脚本中写入转发规则&lt;/p&gt;
&lt;figure class=&quot;highlight routeros&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=
      
    
    </summary>
    
      <category term="nginx" scheme="http://ningmo.github.io/categories/nginx/"/>
    
    
      <category term="linux" scheme="http://ningmo.github.io/tags/linux/"/>
    
      <category term="centos" scheme="http://ningmo.github.io/tags/centos/"/>
    
  </entry>
  
  <entry>
    <title>docker-compose build报错</title>
    <link href="http://ningmo.github.io/2021/08/17/devops/docker-error/"/>
    <id>http://ningmo.github.io/2021/08/17/devops/docker-error/</id>
    <published>2021-08-17T07:20:08.000Z</published>
    <updated>2021-08-17T07:57:07.681Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight excel"><table><tr><td class="code"><pre><span class="line">% docker-compose build</span><br><span class="line">Building chrome</span><br><span class="line">[+] Building <span class="number">0.4</span>s (<span class="number">3</span>/<span class="number">3</span>) FINISHED                                                                                                                                                                                                                                              </span><br><span class="line">=&gt; [internal] load build definition from Dockerfile2                                                                                                                                                                                                                    <span class="number">0.0</span>s</span><br><span class="line">=&gt; =&gt; transferring dockerfi<span class="symbol">le:</span> <span class="number">38</span>B                                                                                                                                                                                                                                      <span class="number">0.0</span>s</span><br><span class="line">=&gt; [internal] load .dockerignore                                                                                                                                                                                                                                        <span class="number">0.0</span>s</span><br><span class="line">=&gt; =&gt; transferring conte<span class="symbol">xt:</span> <span class="number">34</span>B                                                                                                                                                                                                                                         <span class="number">0.0</span>s</span><br><span class="line">=&gt; ERROR [internal] load metadata for docker.io/library/ubun<span class="symbol">tu:18</span>.<span class="number">04</span>                                                                                                                                                                                                    <span class="number">0.3</span>s</span><br><span class="line">------</span><br><span class="line">&gt; [internal] load metadata for docker.io/library/ubun<span class="symbol">tu:18</span>.<span class="symbol">04:</span></span><br><span class="line">------</span><br><span class="line">failed to solve with frontend dockerfile.<span class="symbol">v0</span>: failed to create LLB definiti<span class="symbol">on:</span> failed to do reque<span class="symbol">st:</span> Head htt<span class="symbol">ps:</span>//hub-mirror.c.<span class="number">163</span>.com/<span class="symbol">v2</span>/library/ubuntu/manifests/<span class="number">18.04</span>?ns=docker.<span class="symbol">io:</span> Bad Request</span><br><span class="line">ERR<span class="symbol">OR:</span> Service 'chrome' failed to build <span class="symbol">:</span> Build failed</span><br></pre></td></tr></table></figure><p>执行</p><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">DOCKER_BUILDKIT</span>=0</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">COMPOSE_DOCKER_CLI_BUILD</span>=0</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight excel&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;% docker-compose build&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Buil
      
    
    </summary>
    
      <category term="docker" scheme="http://ningmo.github.io/categories/docker/"/>
    
    
      <category term="docker" scheme="http://ningmo.github.io/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>gin embed打包示例</title>
    <link href="http://ningmo.github.io/2021/05/21/go/gin%20embed%E6%89%93%E5%8C%85%E7%A4%BA%E4%BE%8B/"/>
    <id>http://ningmo.github.io/2021/05/21/go/gin embed打包示例/</id>
    <published>2021-05-21T07:35:00.000Z</published>
    <updated>2021-05-21T07:37:29.523Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"embed"</span></span><br><span class="line"><span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line"><span class="string">"html/template"</span></span><br><span class="line"><span class="string">"io/fs"</span></span><br><span class="line"><span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 下面这一行非常重要！！！！！！</span></span><br><span class="line"><span class="comment">//go:embed templates static</span></span><br><span class="line"><span class="keyword">var</span> FS embed.FS</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">gin.SetMode(gin.ReleaseMode)</span><br><span class="line"></span><br><span class="line">router := gin.Default()</span><br><span class="line">templ := template.Must(template.New(<span class="string">""</span>).ParseFS(FS, <span class="string">"templates/*.html"</span>))</span><br><span class="line">router.SetHTMLTemplate(templ)</span><br><span class="line"></span><br><span class="line">fe, _ := fs.Sub(FS, <span class="string">"static"</span>)</span><br><span class="line">router.StaticFS(<span class="string">"/static"</span>, http.FS(fe))</span><br><span class="line"></span><br><span class="line">router.GET(<span class="string">"/"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.HTML(http.StatusOK, <span class="string">"index.html"</span>,gin.H&#123;&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">router.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;package&lt;/span&gt; main&lt;/span&gt;&lt;br&gt;&lt;span c
      
    
    </summary>
    
      <category term="go" scheme="http://ningmo.github.io/categories/go/"/>
    
    
      <category term="gin" scheme="http://ningmo.github.io/tags/gin/"/>
    
      <category term="go" scheme="http://ningmo.github.io/tags/go/"/>
    
      <category term="golang" scheme="http://ningmo.github.io/tags/golang/"/>
    
      <category term="embed" scheme="http://ningmo.github.io/tags/embed/"/>
    
  </entry>
  
  <entry>
    <title>在rancher上搭建es7集群</title>
    <link href="http://ningmo.github.io/2020/06/24/elk/rancher%E6%90%AD%E5%BB%BAes%E9%9B%86%E7%BE%A4/"/>
    <id>http://ningmo.github.io/2020/06/24/elk/rancher搭建es集群/</id>
    <published>2020-06-24T06:20:00.000Z</published>
    <updated>2021-05-08T01:16:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>平台环境 : rancher</p><p>es镜像 : docker.elastic.co/elasticsearch/elasticsearch:7.2.1</p><p>每个容器建一个磁盘并映射(注意用户权限)<br>配置与环境变量</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">cluster.name:</span> <span class="string">es_cluster_brand</span></span><br><span class="line"><span class="attr">cluster.initial_master_nodes:</span> <span class="string">node1</span></span><br><span class="line"><span class="attr">node.name:</span> <span class="string">node1</span></span><br><span class="line"><span class="attr">node.master:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">node.data:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">path.data:</span> <span class="string">/data</span></span><br><span class="line"><span class="attr">discovery.seed_hosts:</span> <span class="string">node1,node2</span></span><br><span class="line"><span class="attr">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">http.cors.allow-origin:</span> <span class="string">"*"</span></span><br><span class="line"><span class="attr">http.port:</span> <span class="number">9200</span></span><br><span class="line"><span class="attr">network.publish_host:</span> <span class="string">node1</span></span><br><span class="line"><span class="attr">network.bind_host:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="attr">network.host:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="attr">bootstrap.memory_lock:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">bootstrap.system_call_filter:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">cluster.name:</span> <span class="string">es_cluster_brand</span></span><br><span class="line"><span class="attr">cluster.initial_master_nodes:</span> <span class="string">node1</span></span><br><span class="line"><span class="attr">node.name:</span> <span class="string">node2</span></span><br><span class="line"><span class="attr">node.master:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">node.data:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">path.data:</span> <span class="string">/data</span></span><br><span class="line"><span class="attr">discovery.seed_hosts:</span> <span class="string">node1,node2</span></span><br><span class="line"><span class="attr">http.port:</span> <span class="number">9200</span></span><br><span class="line"><span class="attr">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">http.cors.allow-origin:</span> <span class="string">"*"</span></span><br><span class="line"><span class="attr">network.publish_host:</span> <span class="string">node2</span></span><br><span class="line"><span class="attr">network.bind_host:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="attr">network.host:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="attr">bootstrap.memory_lock:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">bootstrap.system_call_filter:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">cluster.name:</span> <span class="string">es_cluster_brand</span></span><br><span class="line"><span class="attr">cluster.initial_master_nodes:</span> <span class="string">node1</span></span><br><span class="line"><span class="attr">node.name:</span> <span class="string">node3</span></span><br><span class="line"><span class="attr">node.master:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">node.data:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">path.data:</span> <span class="string">/data</span></span><br><span class="line"><span class="attr">discovery.seed_hosts:</span> <span class="string">node1,node2</span></span><br><span class="line"><span class="attr">http.port:</span> <span class="number">9200</span></span><br><span class="line"><span class="attr">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">http.cors.allow-origin:</span> <span class="string">"*"</span></span><br><span class="line"><span class="attr">network.publish_host:</span> <span class="string">node3</span></span><br><span class="line"><span class="attr">network.bind_host:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="attr">network.host:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="attr">bootstrap.memory_lock:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">bootstrap.system_call_filter:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>然后建立域名映射到node1(主节点)<br>主机每个rancher实例的名字 都与其节点名字一致  防止出问题</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;平台环境 : rancher&lt;/p&gt;
&lt;p&gt;es镜像 : docker.elastic.co/elasticsearch/elasticsearch:7.2.1&lt;/p&gt;
&lt;p&gt;每个容器建一个磁盘并映射(注意用户权限)&lt;br&gt;配置与环境变量&lt;/p&gt;
&lt;figure class
      
    
    </summary>
    
      <category term="elasticsearch" scheme="http://ningmo.github.io/categories/elasticsearch/"/>
    
    
      <category term="elasticsearch" scheme="http://ningmo.github.io/tags/elasticsearch/"/>
    
      <category term="aggs" scheme="http://ningmo.github.io/tags/aggs/"/>
    
  </entry>
  
  <entry>
    <title>Mysql从ibd恢复数据</title>
    <link href="http://ningmo.github.io/2019/10/21/mysql/mysql%E4%BB%8Eibd%E6%96%87%E4%BB%B6%E6%81%A2%E5%A4%8D%E6%95%B0%E6%8D%AE/"/>
    <id>http://ningmo.github.io/2019/10/21/mysql/mysql从ibd文件恢复数据/</id>
    <published>2019-10-21T07:21:34.000Z</published>
    <updated>2021-05-08T01:16:16.000Z</updated>
    
    <content type="html"><![CDATA[<ol><li><p>创建表结构</p></li><li><p>删除表空间</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> table_a discard <span class="keyword">tablespace</span>;</span><br></pre></td></tr></table></figure></li><li><p>复制ibd文件到新库文件夹下 命名 table_a.ibd 修改文件权限 使mysql可以读写</p></li><li><p>导入表空间</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> table_a <span class="keyword">import</span> <span class="keyword">tablespace</span>;</span><br></pre></td></tr></table></figure></li></ol><p>如出现报错 </p><figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">Schema mismatch (<span class="keyword">Table</span> has ROW_TYPE_DYNAMIC row <span class="keyword">format</span>, .ibd <span class="keyword">file</span> has ROW_TYPE_COMPACT row <span class="keyword">format</span>.</span><br></pre></td></tr></table></figure><p>则说明新建表与ibd表的row format不一致</p><p>删除新表 ,同时删除刚才拷贝过来的ibd文件<br>重新建表时指定row format使一致,如</p><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">ROW_FORMAT</span>=COMPACT</span><br></pre></td></tr></table></figure><p>然后再次从步骤[3]开始进行</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ol&gt;
&lt;li&gt;&lt;p&gt;创建表结构&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;删除表空间&lt;/p&gt;
&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;
      
    
    </summary>
    
      <category term="mysql" scheme="http://ningmo.github.io/categories/mysql/"/>
    
    
  </entry>
  
  <entry>
    <title>elasticsearch reindex</title>
    <link href="http://ningmo.github.io/2019/08/29/elk/reindex/"/>
    <id>http://ningmo.github.io/2019/08/29/elk/reindex/</id>
    <published>2019-08-29T13:57:14.000Z</published>
    <updated>2021-05-08T01:16:16.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="适用reindex的情景"><a href="#适用reindex的情景" class="headerlink" title="适用reindex的情景"></a>适用reindex的情景</h2><h3 id="1-mapping发生变更-字段类型变更-分词器及字典更新"><a href="#1-mapping发生变更-字段类型变更-分词器及字典更新" class="headerlink" title="1. mapping发生变更 字段类型变更 分词器及字典更新"></a>1. mapping发生变更 字段类型变更 分词器及字典更新</h3><h3 id="2-setting发生变更-主分片数量发生变更"><a href="#2-setting发生变更-主分片数量发生变更" class="headerlink" title="2. setting发生变更 主分片数量发生变更"></a>2. setting发生变更 主分片数量发生变更</h3><h3 id="3-数据迁移"><a href="#3-数据迁移" class="headerlink" title="3. 数据迁移"></a>3. 数据迁移</h3><h2 id="1-update-by-query-在现有索引上重建"><a href="#1-update-by-query-在现有索引上重建" class="headerlink" title="1. update by query 在现有索引上重建"></a>1. update by query 在现有索引上重建</h2><ul><li>对已有增加增加子字段/增加分词器<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"properties"</span>: &#123;</span><br><span class="line">    <span class="attr">"date"</span>:&#123;</span><br><span class="line">      <span class="attr">"type"</span>:<span class="string">"keyword"</span>,  </span><br><span class="line">      <span class="attr">"fields"</span>: &#123;</span><br><span class="line">        <span class="attr">"indate"</span>:&#123;</span><br><span class="line">          <span class="attr">"type"</span>:<span class="string">"text"</span>,</span><br><span class="line">          <span class="attr">"analyzer"</span>:<span class="string">"english"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>然后执行</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="code"><pre><span class="line">POST /my_blogs/_update_by_query</span><br></pre></td></tr></table></figure><h2 id="2-reindex-在其他索引上重建"><a href="#2-reindex-在其他索引上重建" class="headerlink" title="2. reindex 在其他索引上重建"></a>2. reindex 在其他索引上重建</h2><p>需要开启白名单并重启节点</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="code"><pre><span class="line">POST _reindex</span><br><span class="line">&#123;</span><br><span class="line">  "source": &#123;</span><br><span class="line">    "index": "my_blogs"</span><br><span class="line">  &#125;,</span><br><span class="line">  "dest": &#123;</span><br><span class="line">    "index": "new_blogs"</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>同时还支持 筛选数据重建/跨集群重建</p><p>如果重建耗时较长 还支持通过任务id查看进度<br>更多参数详见官方文档</p><p><em>以上要求mapping的_source为enabled</em></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;适用reindex的情景&quot;&gt;&lt;a href=&quot;#适用reindex的情景&quot; class=&quot;headerlink&quot; title=&quot;适用reindex的情景&quot;&gt;&lt;/a&gt;适用reindex的情景&lt;/h2&gt;&lt;h3 id=&quot;1-mapping发生变更-字段类型变更-分词器及
      
    
    </summary>
    
      <category term="elasticsearch" scheme="http://ningmo.github.io/categories/elasticsearch/"/>
    
    
      <category term="elasticsearch" scheme="http://ningmo.github.io/tags/elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>elasticsearch 父子文档</title>
    <link href="http://ningmo.github.io/2019/08/28/elk/%E7%88%B6%E5%AD%90%E6%96%87%E6%A1%A3/"/>
    <id>http://ningmo.github.io/2019/08/28/elk/父子文档/</id>
    <published>2019-08-28T14:16:27.000Z</published>
    <updated>2021-05-08T01:16:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>父子文档 适用于大量更新的操作</p><ol><li><p>定义mappings 设置文档父子关系</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"mappings"</span>: &#123;</span><br><span class="line">    <span class="attr">"properties"</span>: &#123;</span><br><span class="line">        <span class="attr">"blog_comments_relation"</span>:&#123;</span><br><span class="line">          <span class="attr">"type"</span>:<span class="string">"join"</span>,</span><br><span class="line">          <span class="attr">"relations"</span>:&#123;</span><br><span class="line">            <span class="attr">"blog"</span>:<span class="string">"comments"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"title"</span>:&#123;</span><br><span class="line">          <span class="attr">"type"</span>:<span class="string">"text"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"content"</span>:&#123;</span><br><span class="line">          <span class="attr">"type"</span>:<span class="string">"keyword"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>索引数据</p></li></ol><ul><li><p>索引父文档 明确文档id</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="code"><pre><span class="line">PUT /my_blogs/_doc/blog_id_1</span><br><span class="line">&#123;</span><br><span class="line">  "title":"super book",</span><br><span class="line">  "content":"dfslkfjdsafdskla;klf",</span><br><span class="line">  "blog_contents_relation":&#123;</span><br><span class="line">    "name":"blog"</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>索引子文当 需指定其父文档id</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="code"><pre><span class="line">PUT /my_blogs/_doc/comments_id_1?routing=blog_id_1</span><br><span class="line">&#123;</span><br><span class="line">  "comments":"22222222222",</span><br><span class="line">  "username":"user2",</span><br><span class="line">  "blog_contents_relation":&#123;</span><br><span class="line">    "name":"comments",</span><br><span class="line">    "parent":"blog_id_1"</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>根据父id查询子文档</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>:&#123;</span><br><span class="line">    <span class="attr">"parent_id"</span>:&#123;</span><br><span class="line">      <span class="attr">"type"</span>:<span class="string">"comments"</span>,</span><br><span class="line">      <span class="attr">"id"</span>:<span class="string">"blog_id_1"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>根据子文档 查询父文档</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>:&#123;</span><br><span class="line">    <span class="attr">"has_child"</span>:&#123;</span><br><span class="line">      <span class="attr">"type"</span>:<span class="string">"comments"</span>,</span><br><span class="line">      <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"match"</span>: &#123;</span><br><span class="line">          <span class="attr">"username"</span>: <span class="string">"user1"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;父子文档 适用于大量更新的操作&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;定义mappings 设置文档父子关系&lt;/p&gt;
&lt;figure class=&quot;highlight json&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line
      
    
    </summary>
    
      <category term="elasticsearch" scheme="http://ningmo.github.io/categories/elasticsearch/"/>
    
    
      <category term="elasticsearch" scheme="http://ningmo.github.io/tags/elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>elasticsearch aggs 范围</title>
    <link href="http://ningmo.github.io/2019/08/28/elk/aggs%20%E8%8C%83%E5%9B%B4/"/>
    <id>http://ningmo.github.io/2019/08/28/elk/aggs 范围/</id>
    <published>2019-08-28T13:24:22.000Z</published>
    <updated>2021-05-08T01:16:16.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="filter-多范围aggs"><a href="#filter-多范围aggs" class="headerlink" title="filter 多范围aggs"></a>filter 多范围aggs</h2><p>可以在一个查询内对多个范围的数据同时进行aggs<br>如下 对全局数据 以及满足filter条件的数据进行了aggs</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"aggs"</span>:&#123;</span><br><span class="line">      <span class="attr">"myFilter"</span>:&#123;</span><br><span class="line">        <span class="attr">"filter"</span>:&#123;</span><br><span class="line">            <span class="attr">"match"</span>: &#123;</span><br><span class="line">              <span class="attr">"a"</span>: <span class="string">"abc"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"aggs"</span>: &#123;</span><br><span class="line">          <span class="attr">"by_myfilter"</span>: &#123;</span><br><span class="line">            <span class="attr">"terms"</span>: &#123;</span><br><span class="line">              <span class="attr">"field"</span>: <span class="string">"d"</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"to_all_aggs"</span>:&#123;</span><br><span class="line">      <span class="attr">"terms"</span>: &#123;</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"d"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="post-filter-对aggs的结果进行filter-返回命中的文档"><a href="#post-filter-对aggs的结果进行filter-返回命中的文档" class="headerlink" title="post filter 对aggs的结果进行filter 返回命中的文档"></a>post filter 对aggs的结果进行filter 返回命中的文档</h3><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"aggs"</span>:&#123;</span><br><span class="line">      <span class="attr">"by_d"</span>: &#123;</span><br><span class="line">        <span class="attr">"terms"</span>: &#123;</span><br><span class="line">          <span class="attr">"field"</span>: <span class="string">"d"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"post_filter"</span>:&#123;</span><br><span class="line">      <span class="attr">"match"</span>: &#123;</span><br><span class="line">        <span class="attr">"a"</span>: <span class="string">"abc"</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="global-忽略query条件"><a href="#global-忽略query条件" class="headerlink" title="global 忽略query条件"></a>global 忽略query条件</h3><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">   <span class="attr">"match"</span>: &#123;</span><br><span class="line">     <span class="attr">"FIELD"</span>: <span class="string">"TEXT"</span></span><br><span class="line">   &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"aggs"</span>:&#123;</span><br><span class="line">    <span class="attr">"by_field"</span>:&#123;</span><br><span class="line">      <span class="attr">"terms"</span>: &#123;</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"d"</span>,</span><br><span class="line">        <span class="attr">"size"</span>: <span class="number">10</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"all"</span>:&#123;</span><br><span class="line">      <span class="attr">"global"</span>: &#123;&#125;,</span><br><span class="line">      <span class="attr">"aggs"</span>:&#123;</span><br><span class="line">          <span class="attr">"by_d"</span>:&#123;</span><br><span class="line">            <span class="attr">"terms"</span>: &#123;</span><br><span class="line">              <span class="attr">"field"</span>: <span class="string">""</span>,</span><br><span class="line">              <span class="attr">"size"</span>: <span class="number">10</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;filter-多范围aggs&quot;&gt;&lt;a href=&quot;#filter-多范围aggs&quot; class=&quot;headerlink&quot; title=&quot;filter 多范围aggs&quot;&gt;&lt;/a&gt;filter 多范围aggs&lt;/h2&gt;&lt;p&gt;可以在一个查询内对多个范围的数据同时进行ag
      
    
    </summary>
    
      <category term="elasticsearch" scheme="http://ningmo.github.io/categories/elasticsearch/"/>
    
    
      <category term="elasticsearch" scheme="http://ningmo.github.io/tags/elasticsearch/"/>
    
      <category term="aggs" scheme="http://ningmo.github.io/tags/aggs/"/>
    
  </entry>
  
  <entry>
    <title>elasticsearch aggs方式</title>
    <link href="http://ningmo.github.io/2019/08/27/elk/aggs/"/>
    <id>http://ningmo.github.io/2019/08/27/elk/aggs/</id>
    <published>2019-08-27T14:18:00.000Z</published>
    <updated>2021-05-08T01:16:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>以下内容基于ES7</p><p>a为text d为keyword  e为text(fielddata=true)</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"mappings"</span>: &#123;</span><br><span class="line">    <span class="attr">"properties"</span>: &#123;</span><br><span class="line">        <span class="attr">"a"</span>:&#123;</span><br><span class="line">          <span class="attr">"type"</span>:<span class="string">"text"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"d"</span>:&#123;</span><br><span class="line">          <span class="attr">"type"</span>:<span class="string">"keyword"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"e"</span>:&#123;</span><br><span class="line">          <span class="attr">"type"</span>:<span class="string">"text"</span>,</span><br><span class="line">          <span class="attr">"fielddata"</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-terms-aggs"><a href="#1-terms-aggs" class="headerlink" title="1. terms aggs"></a>1. terms aggs</h3><ul><li><p>对精确值keyword(不可分词)字段的分组 keyword或text.keyword</p></li><li><p>对设置fielddata=true的text字段进行aggs 将对字段值进行分词后的结果进行aggs<br>进行aggs查询</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"aggs"</span>:&#123;</span><br><span class="line">    <span class="attr">"txt"</span>:&#123;</span><br><span class="line">      <span class="attr">"terms"</span>:&#123;</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"a.keyword"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"k"</span>:&#123;</span><br><span class="line">      <span class="attr">"terms"</span>:&#123;</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"d"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"kf"</span>:&#123;</span><br><span class="line">      <span class="attr">"terms"</span>:&#123;</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"e"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>top_hits 获取aggs后bucket中命中的key的文档</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"aggs"</span>:&#123;</span><br><span class="line">      <span class="attr">"by_e"</span>:&#123;</span><br><span class="line">        <span class="attr">"terms"</span>:&#123;</span><br><span class="line">            <span class="attr">"field"</span>:<span class="string">"e"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"aggs"</span>: &#123;</span><br><span class="line">          <span class="attr">"most_group"</span>: &#123;</span><br><span class="line">            <span class="attr">"top_hits"</span>: &#123;</span><br><span class="line">              <span class="attr">"size"</span>: <span class="number">10</span>,</span><br><span class="line">              <span class="attr">"sort"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="attr">"i"</span>:&#123;</span><br><span class="line">                    <span class="attr">"order"</span>: <span class="string">"desc"</span></span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>性能 打开分词字段的eager_global_ordinals(在mapping中的type下面添加)*</p><h3 id="2-metric-aggs-分组统计"><a href="#2-metric-aggs-分组统计" class="headerlink" title="2. metric aggs 分组统计"></a>2. metric aggs 分组统计</h3></li><li><p>min/max/avg/sum/stats </p></li><li><p>cardinate 类似于mysql的count(distinct(字段))</p></li></ul><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"aggs"</span>:&#123;</span><br><span class="line">      <span class="attr">"count_distinct"</span>:&#123;</span><br><span class="line">        <span class="attr">"cardinality"</span>:&#123;</span><br><span class="line">            <span class="attr">"field"</span>:<span class="string">"e"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-range-aggs-区间范围分组"><a href="#3-range-aggs-区间范围分组" class="headerlink" title="3. range aggs 区间范围分组"></a>3. range aggs 区间范围分组</h3><h3 id="4-histogram-aggs-对指定范围内的等差区间进行aggs"><a href="#4-histogram-aggs-对指定范围内的等差区间进行aggs" class="headerlink" title="4. histogram aggs 对指定范围内的等差区间进行aggs"></a>4. histogram aggs 对指定范围内的等差区间进行aggs</h3><h3 id="5-pipeline-对terms嵌套metric的结果进行进一步metric"><a href="#5-pipeline-对terms嵌套metric的结果进行进一步metric" class="headerlink" title="5.pipeline  对terms嵌套metric的结果进行进一步metric"></a>5.pipeline  对terms嵌套metric的结果进行进一步metric</h3><ul><li>min_bucket/max_bucket/stats_bucket/avg_bucket/sum_bucket</li><li>derivative…</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;以下内容基于ES7&lt;/p&gt;
&lt;p&gt;a为text d为keyword  e为text(fielddata=true)&lt;/p&gt;
&lt;figure class=&quot;highlight json&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class
      
    
    </summary>
    
      <category term="elasticsearch" scheme="http://ningmo.github.io/categories/elasticsearch/"/>
    
    
      <category term="elasticsearch" scheme="http://ningmo.github.io/tags/elasticsearch/"/>
    
      <category term="aggs" scheme="http://ningmo.github.io/tags/aggs/"/>
    
  </entry>
  
  <entry>
    <title>搜索时定义score权重</title>
    <link href="http://ningmo.github.io/2019/08/27/elk/%E6%90%9C%E7%B4%A2%E6%97%B6%E8%AE%BE%E5%AE%9Ascore%E6%9D%83%E9%87%8D/"/>
    <id>http://ningmo.github.io/2019/08/27/elk/搜索时设定score权重/</id>
    <published>2019-08-27T14:18:00.000Z</published>
    <updated>2021-05-08T01:16:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>匹配任一条件并设定其匹配的score权重</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$nameBoost = [];</span><br><span class="line">$nameBoost[<span class="string">'bool'</span>][<span class="string">'should'</span>][] = [<span class="string">'terms'</span>=&gt;[<span class="string">'name'</span>=&gt;$nameOrderSet,<span class="string">"boost"</span>=&gt; <span class="number">500</span>]];</span><br><span class="line">$nameBoost[<span class="string">'bool'</span>][<span class="string">'should'</span>][] = [<span class="string">'wildcard'</span>=&gt;[<span class="string">'name'</span>=&gt;[<span class="string">'value'</span>=&gt;$name.<span class="string">'?'</span>,<span class="string">"boost"</span>=&gt; <span class="number">200</span>]]];</span><br><span class="line">$nameBoost[<span class="string">'bool'</span>][<span class="string">'should'</span>][] = [<span class="string">'wildcard'</span>=&gt;[<span class="string">'name'</span>=&gt;[<span class="string">'value'</span>=&gt;$name.<span class="string">'*'</span>,<span class="string">"boost"</span>=&gt; <span class="number">100</span>]]];</span><br><span class="line">$params[<span class="string">'body'</span>][<span class="string">'query'</span>][<span class="string">'bool'</span>][<span class="string">'must'</span>][]  = $boolQuery;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;匹配任一条件并设定其匹配的score权重&lt;/p&gt;
&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$nameBoost = [];&lt;/span&gt;&lt;br&gt;&lt;sp
      
    
    </summary>
    
      <category term="elasticsearch" scheme="http://ningmo.github.io/categories/elasticsearch/"/>
    
    
      <category term="elasticsearch" scheme="http://ningmo.github.io/tags/elasticsearch/"/>
    
      <category term="score" scheme="http://ningmo.github.io/tags/score/"/>
    
  </entry>
  
  <entry>
    <title>elasticsearch search suggest</title>
    <link href="http://ningmo.github.io/2019/08/26/elk/search%20suggest/"/>
    <id>http://ningmo.github.io/2019/08/26/elk/search suggest/</id>
    <published>2019-08-26T13:33:35.000Z</published>
    <updated>2021-05-08T01:16:16.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-term-suggest-常用于拼写错误"><a href="#1-term-suggest-常用于拼写错误" class="headerlink" title="1. term suggest 常用于拼写错误"></a>1. term suggest 常用于拼写错误</h3><figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line">POST /kiban<span class="built_in">a_sample</span>_dat<span class="built_in">a_logs</span>/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"suggest"</span>:&#123;</span><br><span class="line">    <span class="string">"term-suggestion"</span>:&#123;</span><br><span class="line">      <span class="string">"text"</span>:<span class="string">"elastia"</span>,</span><br><span class="line">      <span class="string">"term"</span>:&#123;</span><br><span class="line">        <span class="string">"suggest_mode"</span>:<span class="string">"popular"</span>,</span><br><span class="line">        <span class="string">"field"</span>:<span class="string">"url"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>result:</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"took"</span> : <span class="number">65</span>,</span><br><span class="line">  <span class="attr">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"_shards"</span> : &#123;</span><br><span class="line">    <span class="attr">"total"</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"successful"</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"skipped"</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"failed"</span> : <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"hits"</span> : &#123;</span><br><span class="line">    <span class="attr">"total"</span> : &#123;</span><br><span class="line">      <span class="attr">"value"</span> : <span class="number">0</span>,</span><br><span class="line">      <span class="attr">"relation"</span> : <span class="string">"eq"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"max_score"</span> : <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"hits"</span> : [ ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"suggest"</span> : &#123;</span><br><span class="line">    <span class="attr">"term-suggestion"</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"text"</span> : <span class="string">"elastia"</span>,</span><br><span class="line">        <span class="attr">"offset"</span> : <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"length"</span> : <span class="number">7</span>,</span><br><span class="line">        <span class="attr">"options"</span> : [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"text"</span> : <span class="string">"elastic"</span>,</span><br><span class="line">            <span class="attr">"score"</span> : <span class="number">0.85714287</span>,</span><br><span class="line">            <span class="attr">"freq"</span> : <span class="number">2724</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>suggest_mode</p><ul><li>missing 如索引中已存在,就不提供建议</li><li>popular 推荐出现频率更高的词</li><li>always 无论是否存在 都提供建议 </li></ul><h3 id="2-phrase-suggest"><a href="#2-phrase-suggest" class="headerlink" title="2. phrase suggest"></a>2. phrase suggest</h3><h3 id="3-completion-suggest-自动不全"><a href="#3-completion-suggest-自动不全" class="headerlink" title="3.completion suggest 自动不全"></a>3.completion suggest 自动不全</h3><p>需要先定义mapping 字段设置type为 completion</p><figure class="highlight dts"><table><tr><td class="code"><pre><span class="line">PUT completion_index_a</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"mappings"</span>: &#123;</span><br><span class="line">    <span class="string">"properties"</span>: &#123;</span><br><span class="line">      <span class="string">"yourfield"</span>:&#123;</span><br><span class="line">        <span class="string">"type"</span>: <span class="string">"completion"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>result</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"acknowledged"</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"shards_acknowledged"</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"index"</span> : <span class="string">"completion_index_a"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用</p><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">POST <span class="regexp">/completion_index_a/</span>_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"suggest"</span>:&#123;</span><br><span class="line">    <span class="string">"comp-suggestion"</span>:&#123;</span><br><span class="line">      <span class="string">"prefix"</span>:<span class="string">"n"</span>,</span><br><span class="line">      <span class="string">"completion"</span>:&#123;</span><br><span class="line">        <span class="string">"field"</span>:<span class="string">"yourfield"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-context-suggest-上下文建议"><a href="#4-context-suggest-上下文建议" class="headerlink" title="4..context suggest 上下文建议"></a>4..context suggest 上下文建议</h3>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;1-term-suggest-常用于拼写错误&quot;&gt;&lt;a href=&quot;#1-term-suggest-常用于拼写错误&quot; class=&quot;headerlink&quot; title=&quot;1. term suggest 常用于拼写错误&quot;&gt;&lt;/a&gt;1. term suggest 常用于
      
    
    </summary>
    
      <category term="elasticsearch" scheme="http://ningmo.github.io/categories/elasticsearch/"/>
    
    
      <category term="elasticsearch" scheme="http://ningmo.github.io/tags/elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>elasticsearch search template</title>
    <link href="http://ningmo.github.io/2019/08/26/elk/search%20template/"/>
    <id>http://ningmo.github.io/2019/08/26/elk/search template/</id>
    <published>2019-08-26T13:33:35.000Z</published>
    <updated>2021-05-08T01:16:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>创建搜索模板</p><figure class="highlight prolog"><table><tr><td class="code"><pre><span class="line"><span class="symbol">POST</span> <span class="symbol">_scripts</span>/.kibana_1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"script"</span>:&#123;</span><br><span class="line">    <span class="string">"lang"</span>: <span class="string">"mustache"</span>,</span><br><span class="line">    <span class="string">"source"</span>:&#123;</span><br><span class="line">      <span class="string">"_source"</span>:[<span class="string">"name"</span>,<span class="string">"description"</span>,<span class="string">"color"</span>],</span><br><span class="line">      <span class="string">"size"</span>:<span class="number">20</span>,</span><br><span class="line">      <span class="string">"query"</span>:&#123;</span><br><span class="line">        <span class="string">"multi_match"</span>: &#123;</span><br><span class="line">          <span class="string">"query"</span>: <span class="string">"&#123;&#123;q&#125;&#125;"</span>,</span><br><span class="line">          <span class="string">"fields"</span>: [<span class="string">"name"</span>,<span class="string">"description"</span>]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看</span></span><br><span class="line">GET _scripts/<span class="string">.kibana_1</span></span><br><span class="line"><span class="comment"># 查看删除模板</span></span><br><span class="line">DELETE _scripts/<span class="string">.kibana_1</span></span><br></pre></td></tr></table></figure><p>使用</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">POST searchTplA/_search/<span class="keyword">template</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"id"</span>:<span class="string">".kibana_1"</span>,</span><br><span class="line">  <span class="string">"params"</span>: &#123;</span><br><span class="line">    <span class="string">"search"</span>:<span class="string">"a"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;创建搜索模板&lt;/p&gt;
&lt;figure class=&quot;highlight prolog&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;POST&lt;/span&gt; &lt;span cl
      
    
    </summary>
    
      <category term="elasticsearch" scheme="http://ningmo.github.io/categories/elasticsearch/"/>
    
    
      <category term="elasticsearch" scheme="http://ningmo.github.io/tags/elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>git changelog</title>
    <link href="http://ningmo.github.io/2019/08/26/git-changelog/"/>
    <id>http://ningmo.github.io/2019/08/26/git-changelog/</id>
    <published>2019-08-26T06:15:44.000Z</published>
    <updated>2021-05-08T01:16:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>软件环境安装</p><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">npm <span class="keyword">install</span> commitizen -g <span class="comment"># 也可在项目根目录本地安装 --save-dev</span></span><br><span class="line">npm <span class="keyword">install</span> -g conventional-changelog-cli <span class="comment"># 也可在项目根目录本地安装 --save-dev</span></span><br></pre></td></tr></table></figure><p>配置</p><figure class="highlight q"><table><tr><td class="code"><pre><span class="line">commitizen init cz-conventional-changelog --<span class="built_in">save</span>-<span class="built_in">dev</span> --<span class="built_in">save</span>-exact</span><br></pre></td></tr></table></figure><p>如果出现报错(极大可能是node版本问题 可以切换node版本)<br>指定适配器</p><p>vim .czrc</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">"path"</span>: <span class="string">"cz-conventional-changelog"</span>&#125;</span><br></pre></td></tr></table></figure><p>指定生成标准angular可选 angular/atom/…</p><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">conventional-changelog -<span class="selector-tag">p</span> angular -<span class="selector-tag">i</span> CHANGELOG<span class="selector-class">.md</span> -s</span><br><span class="line"></span><br><span class="line">git add .</span><br><span class="line">git cz</span><br></pre></td></tr></table></figure><p>释义</p><ul><li>feat 新功能</li><li>fix Bug修复</li><li>docs 文档更新</li><li>style 代码的格式，标点符号的更新</li><li>refactor 代码重构</li><li>perf 性能优化</li><li>test 测试更新</li><li>build 构建系统或者包依赖更新</li><li>ci CI 配置，脚本文件等更新</li><li>chore 非 src 或者 测试文件的更新</li><li>revert commit 回退</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;软件环境安装&lt;/p&gt;
&lt;figure class=&quot;highlight cmake&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;npm &lt;span class=&quot;keyword&quot;&gt;install&lt;/span&gt; c
      
    
    </summary>
    
      <category term="git" scheme="http://ningmo.github.io/categories/git/"/>
    
    
      <category term="git" scheme="http://ningmo.github.io/tags/git/"/>
    
      <category term="changelog" scheme="http://ningmo.github.io/tags/changelog/"/>
    
  </entry>
  
  <entry>
    <title>kong 使用</title>
    <link href="http://ningmo.github.io/2018/04/04/devops/kong-user/"/>
    <id>http://ningmo.github.io/2018/04/04/devops/kong-user/</id>
    <published>2018-04-04T13:20:08.000Z</published>
    <updated>2021-05-21T08:31:55.348Z</updated>
    
    <content type="html"><![CDATA[<p>kong 总体流程<br>创建接口-给接口添加验证插件-创建用户-给用户创建key</p><p>给接口添加验证插件<br>curl -X POST <a href="http://10.10.107.103:8001/apis/qzh/plugins" target="_blank" rel="noopener">http://10.10.107.103:8001/apis/qzh/plugins</a> -d “name=key-auth”<br>{“api_id”:”1b545af7-42ff-4143-8c70-5a4c323d1a41”,”id”:”8e104fce-5ceb-4a38-b6bf-f8fcfb8ad048”,”created_at”:1522828616000,”enabled”:true,”name”:”key-auth”,”config”:{“hide_credentials”:false,”anonymous”:””,”key_names”:[“apikey”],”key_in_body”:false}}</p><p>给用户创建key<br>curl -X POST <a href="http://10.10.107.103:8001/consumers/qzhuser/key-auth" target="_blank" rel="noopener">http://10.10.107.103:8001/consumers/qzhuser/key-auth</a> -d “key=qzhkey”<br>{“created_at”:1522828821000,”consumer_id”:”f2531e2f-c6ba-4f97-94e4-a9454b70bb95”,”key”:”qzhkey”,”id”:”33fc0bff-7f23-43bc-bf60-e6114f0b04ab”}</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;kong 总体流程&lt;br&gt;创建接口-给接口添加验证插件-创建用户-给用户创建key&lt;/p&gt;
&lt;p&gt;给接口添加验证插件&lt;br&gt;curl -X POST &lt;a href=&quot;http://10.10.107.103:8001/apis/qzh/plugins&quot; target=&quot;_
      
    
    </summary>
    
      <category term="devops" scheme="http://ningmo.github.io/categories/devops/"/>
    
    
      <category term="kong" scheme="http://ningmo.github.io/tags/kong/"/>
    
  </entry>
  
  <entry>
    <title>Algorithms_select</title>
    <link href="http://ningmo.github.io/2016/11/16/Algorithms-select/"/>
    <id>http://ningmo.github.io/2016/11/16/Algorithms-select/</id>
    <published>2016-11-16T12:51:18.000Z</published>
    <updated>2021-05-08T01:16:16.000Z</updated>
    
    <content type="html"><![CDATA[<h5 id="算法练习：选择排序"><a href="#算法练习：选择排序" class="headerlink" title="算法练习：选择排序"></a>算法练习：选择排序</h5><figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">$arr</span> = [];</span></span><br><span class="line"><span class="keyword">for</span>(<span class="symbol">$</span>i=<span class="number">0</span>;<span class="symbol">$</span>i&lt;<span class="number">10</span>;<span class="symbol">$</span>i++)&#123;</span><br><span class="line"><span class="symbol">$</span>arr[] = mt_rand(<span class="number">1</span>,<span class="number">500</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta"><span class="meta-keyword">$arr2</span> = $arr;</span></span><br><span class="line">echo <span class="string">'&lt;pre&gt;&lt;br/&gt;元数据:'</span>;</span><br><span class="line">print_r(<span class="symbol">$</span>arr);</span><br><span class="line">echo <span class="string">'&lt;br/&gt;'</span>;</span><br><span class="line"><span class="meta"><span class="meta-keyword">$l</span> = 0;</span></span><br><span class="line"><span class="meta"><span class="meta-keyword">$result</span> = [];</span></span><br><span class="line"></span><br><span class="line"># asc</span><br><span class="line"><span class="keyword">for</span>(<span class="symbol">$</span>i=<span class="number">0</span>;<span class="symbol">$</span>i&lt;count(<span class="symbol">$</span>arr);<span class="symbol">$</span>i++)&#123;</span><br><span class="line"><span class="symbol">$</span><span class="built-in">min</span> = <span class="symbol">$</span>arr[<span class="symbol">$</span>i];</span><br><span class="line"><span class="keyword">for</span>(<span class="symbol">$</span>j=<span class="symbol">$</span>i;<span class="symbol">$</span>j&lt;count(<span class="symbol">$</span>arr)<span class="number">-1</span>;<span class="symbol">$</span>j++)&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="symbol">$</span><span class="built-in">min</span>&gt;<span class="symbol">$</span>arr[<span class="symbol">$</span>j+<span class="number">1</span>])&#123;</span><br><span class="line"><span class="symbol">$</span>tmp = <span class="symbol">$</span>arr[<span class="symbol">$</span>j+<span class="number">1</span>];</span><br><span class="line"><span class="symbol">$</span>arr[<span class="symbol">$</span>j+<span class="number">1</span>] = <span class="symbol">$</span><span class="built-in">min</span>;</span><br><span class="line"><span class="symbol">$</span><span class="built-in">min</span> = <span class="symbol">$</span>tmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="symbol">$</span>l += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="symbol">$</span>result[<span class="symbol">$</span>i] = <span class="symbol">$</span><span class="built-in">min</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">echo <span class="string">'Asc Result:&lt;br/&gt;'</span>;</span><br><span class="line">print_r(<span class="symbol">$</span>result);</span><br><span class="line">echo <span class="string">'length:'</span>.<span class="symbol">$</span>l.<span class="string">'&lt;br/&gt;'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="meta-keyword">$l</span> = 0;</span></span><br><span class="line"># desc</span><br><span class="line"><span class="meta"><span class="meta-keyword">$result2</span> = [];</span></span><br><span class="line"><span class="keyword">for</span>(<span class="symbol">$</span>i=<span class="number">0</span>;<span class="symbol">$</span>i&lt;count(<span class="symbol">$</span>arr2);<span class="symbol">$</span>i++)&#123;</span><br><span class="line"><span class="symbol">$</span><span class="built-in">max</span> = <span class="symbol">$</span>arr2[<span class="symbol">$</span>i];</span><br><span class="line"><span class="keyword">for</span>(<span class="symbol">$</span>j=<span class="symbol">$</span>i;<span class="symbol">$</span>j&lt;count(<span class="symbol">$</span>arr2)<span class="number">-1</span>;<span class="symbol">$</span>j++)&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="symbol">$</span><span class="built-in">max</span>&lt;<span class="symbol">$</span>arr2[<span class="symbol">$</span>j+<span class="number">1</span>])&#123;</span><br><span class="line"><span class="symbol">$</span>tmp = <span class="symbol">$</span>arr2[<span class="symbol">$</span>j+<span class="number">1</span>];</span><br><span class="line"><span class="symbol">$</span>arr2[<span class="symbol">$</span>j+<span class="number">1</span>] = <span class="symbol">$</span><span class="built-in">max</span>;</span><br><span class="line"><span class="symbol">$</span><span class="built-in">max</span> = <span class="symbol">$</span>tmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="symbol">$</span>l += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="symbol">$</span>result2[count(<span class="symbol">$</span>arr2)<span class="number">-1</span>-<span class="symbol">$</span>i] = <span class="symbol">$</span><span class="built-in">max</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">echo <span class="string">'Desc Result:&lt;br/&gt;'</span>;</span><br><span class="line">print_r(<span class="symbol">$</span>result2);</span><br><span class="line">echo <span class="string">'length:'</span>.<span class="symbol">$</span>l.<span class="string">'&lt;br/&gt;'</span>;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h5 id=&quot;算法练习：选择排序&quot;&gt;&lt;a href=&quot;#算法练习：选择排序&quot; class=&quot;headerlink&quot; title=&quot;算法练习：选择排序&quot;&gt;&lt;/a&gt;算法练习：选择排序&lt;/h5&gt;&lt;figure class=&quot;highlight gams&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td
      
    
    </summary>
    
      <category term="Algorithms" scheme="http://ningmo.github.io/categories/Algorithms/"/>
    
    
      <category term="算法" scheme="http://ningmo.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
      <category term="Algorithms" scheme="http://ningmo.github.io/tags/Algorithms/"/>
    
      <category term="select" scheme="http://ningmo.github.io/tags/select/"/>
    
  </entry>
  
  <entry>
    <title>Algorithms_bubble</title>
    <link href="http://ningmo.github.io/2016/11/16/Algorithms-bubble/"/>
    <id>http://ningmo.github.io/2016/11/16/Algorithms-bubble/</id>
    <published>2016-11-16T11:36:21.000Z</published>
    <updated>2021-05-08T01:16:16.000Z</updated>
    
    <content type="html"><![CDATA[<h5 id="算法练习：冒泡排序"><a href="#算法练习：冒泡排序" class="headerlink" title="算法练习：冒泡排序"></a>算法练习：冒泡排序</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 排序算法</span></span><br><span class="line"><span class="variable">$arr</span> = [];</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=0;<span class="variable">$i</span>&lt;10;<span class="variable">$i</span>++)&#123;</span><br><span class="line"><span class="variable">$arr</span>[] = mt_rand(1,500);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'&lt;pre&gt;'</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'元数据'</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'&lt;br/&gt;'</span>;</span><br><span class="line">print_r(<span class="variable">$arr</span>);</span><br><span class="line"><span class="variable">$result</span> =  <span class="variable">$arr</span>;</span><br><span class="line"><span class="variable">$result2</span> = <span class="variable">$arr</span>;</span><br><span class="line"><span class="comment"># 冒泡 desc</span></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=0;<span class="variable">$i</span>&lt;count(<span class="variable">$result</span>)-1;<span class="variable">$i</span>++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$j</span>=0;<span class="variable">$j</span>&lt;count(<span class="variable">$result</span>)-<span class="variable">$i</span>;<span class="variable">$j</span>++)&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="variable">$j</span>] &lt; <span class="variable">$result</span>[<span class="variable">$j</span>+1])&#123;</span><br><span class="line"><span class="variable">$tmp</span> = <span class="variable">$result</span>[<span class="variable">$j</span>+1];</span><br><span class="line"><span class="variable">$result</span>[<span class="variable">$j</span>+1] = <span class="variable">$result</span>[<span class="variable">$j</span>];</span><br><span class="line"><span class="variable">$result</span>[<span class="variable">$j</span>] = <span class="variable">$tmp</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'&lt;br/&gt;'</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'Desc result'</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'&lt;br/&gt;'</span>;</span><br><span class="line">print_r(<span class="variable">$result</span>);</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'&lt;br/&gt;'</span>;</span><br><span class="line">var_dump(<span class="variable">$result</span> == sort(<span class="variable">$arr</span>));</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;'</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'Asc result&lt;br/&gt;'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># asc</span></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=0;<span class="variable">$i</span>&lt;count(<span class="variable">$result2</span>)-1;<span class="variable">$i</span>++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$j</span>=count(<span class="variable">$result2</span>)-1;<span class="variable">$j</span>&gt;=0;<span class="variable">$j</span>--)&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result2</span>[<span class="variable">$j</span>] &lt; <span class="variable">$result2</span>[<span class="variable">$j</span>-1])&#123;</span><br><span class="line"><span class="variable">$tmp</span> = <span class="variable">$result2</span>[<span class="variable">$j</span>-1];</span><br><span class="line"><span class="variable">$result2</span>[<span class="variable">$j</span>-1] = <span class="variable">$result2</span>[<span class="variable">$j</span>];</span><br><span class="line"><span class="variable">$result2</span>[<span class="variable">$j</span>] = <span class="variable">$tmp</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'&lt;br/&gt;'</span>;</span><br><span class="line">print_r(<span class="variable">$result2</span>);</span><br><span class="line">var_dump(<span class="variable">$result2</span> == sort(<span class="variable">$arr</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最佳时间复杂度 O(n)</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h5 id=&quot;算法练习：冒泡排序&quot;&gt;&lt;a href=&quot;#算法练习：冒泡排序&quot; class=&quot;headerlink&quot; title=&quot;算法练习：冒泡排序&quot;&gt;&lt;/a&gt;算法练习：冒泡排序&lt;/h5&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td
      
    
    </summary>
    
      <category term="Algorithms" scheme="http://ningmo.github.io/categories/Algorithms/"/>
    
    
      <category term="算法" scheme="http://ningmo.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
      <category term="Algorithms" scheme="http://ningmo.github.io/tags/Algorithms/"/>
    
      <category term="bubble" scheme="http://ningmo.github.io/tags/bubble/"/>
    
  </entry>
  
  <entry>
    <title>修改docker源地址</title>
    <link href="http://ningmo.github.io/2016/11/10/devops/docker-registry/"/>
    <id>http://ningmo.github.io/2016/11/10/devops/docker-registry/</id>
    <published>2016-11-10T13:20:08.000Z</published>
    <updated>2021-05-21T08:30:57.763Z</updated>
    
    <content type="html"><![CDATA[<p>maxos 直接找到配置 在registry加入地址即可<br><a href="http://b72d1176.m.daocloud.io" target="_blank" rel="noopener">http://b72d1176.m.daocloud.io</a></p><p>其他系统 修改docker配置文件/etc/default/docker如</p><p>DOCKER_OPTS=”–registry-mirror=<a href="http://b72d1176.m.daocloud.io&quot;" target="_blank" rel="noopener">http://b72d1176.m.daocloud.io&quot;</a></p><p>b72d1176为个人帐号的生成</p><p>可以自己注册帐号后在加速器中找到自己的URL<br>感谢 <a href="https://www.daocloud.io" target="_blank" rel="noopener">daocloud</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;maxos 直接找到配置 在registry加入地址即可&lt;br&gt;&lt;a href=&quot;http://b72d1176.m.daocloud.io&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://b72d1176.m.daocloud.io&lt;/a&gt;&lt;
      
    
    </summary>
    
      <category term="docker" scheme="http://ningmo.github.io/categories/docker/"/>
    
    
      <category term="docker" scheme="http://ningmo.github.io/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>angularjs几种生成工具的尝试</title>
    <link href="http://ningmo.github.io/2016/11/05/js/angularjs-try/"/>
    <id>http://ningmo.github.io/2016/11/05/js/angularjs-try/</id>
    <published>2016-11-05T13:25:25.000Z</published>
    <updated>2021-05-08T01:16:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>想法是弄个angularjs的常用结构出来 可以快速的各种项目开发<br>但是可怜对angular的了解有限 暂时找了几个开源的试试</p><h6 id="generator-angular"><a href="#generator-angular" class="headerlink" title="generator-angular"></a>generator-angular</h6><blockquote><p><a href="https://github.com/yeoman/generator-angular" target="_blank" rel="noopener">https://github.com/yeoman/generator-angular</a><br>安装过程中总出错 依赖有点多  最后竟然没成功</p></blockquote><h6 id="generator-angularjs"><a href="#generator-angularjs" class="headerlink" title="generator-angularjs"></a>generator-angularjs</h6><blockquote><p><a href="https://www.npmjs.com/package/generator-angularjs" target="_blank" rel="noopener">https://www.npmjs.com/package/generator-angularjs</a></p></blockquote><h6 id="generator-angular-nmi"><a href="#generator-angular-nmi" class="headerlink" title="generator-angular-nmi"></a>generator-angular-nmi</h6><blockquote><p><a href="https://www.npmjs.com/package/generator-angular-nmi" target="_blank" rel="noopener">https://www.npmjs.com/package/generator-angular-nmi</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;想法是弄个angularjs的常用结构出来 可以快速的各种项目开发&lt;br&gt;但是可怜对angular的了解有限 暂时找了几个开源的试试&lt;/p&gt;
&lt;h6 id=&quot;generator-angular&quot;&gt;&lt;a href=&quot;#generator-angular&quot; class=&quot;hea
      
    
    </summary>
    
      <category term="js" scheme="http://ningmo.github.io/categories/js/"/>
    
    
      <category term="angularjs" scheme="http://ningmo.github.io/tags/angularjs/"/>
    
      <category term="generator" scheme="http://ningmo.github.io/tags/generator/"/>
    
  </entry>
  
  <entry>
    <title>docker常用命令操作</title>
    <link href="http://ningmo.github.io/2016/11/02/devops/docker-useful/"/>
    <id>http://ningmo.github.io/2016/11/02/devops/docker-useful/</id>
    <published>2016-11-02T13:31:10.000Z</published>
    <updated>2021-05-21T08:30:55.058Z</updated>
    
    <content type="html"><![CDATA[<h5 id="docker-常用命令"><a href="#docker-常用命令" class="headerlink" title="docker 常用命令"></a>docker 常用命令</h5><figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="comment">## 拉取镜像</span></span><br><span class="line">docker pull openresty/openresty</span><br><span class="line">docker images</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建容器</span></span><br><span class="line">docker run -it -m 100MB -h doc.nginx -d <span class="params">--name=</span><span class="string">"nginx"</span> openresty/openresty </span><br><span class="line"><span class="comment"># -c cpu优先级  －m 内存（M） －h 主机  --name 容器名字  镜像  ［/bin/bash 进入容器命令行］</span></span><br><span class="line"><span class="comment"># -p  端口映射 主机端口:容器端口  -v 主机目录:容器目录</span></span><br><span class="line"></span><br><span class="line">示例：</span><br><span class="line">docker run -itd <span class="params">--name=</span><span class="string">"cent"</span> -m 512M -p 8080<span class="function">:80</span> -p 9000<span class="function">:9000</span> -v <span class="string">/Users/moran/Documents/angular/</span>:<span class="string">/data/angular</span> centos</span><br><span class="line"></span><br><span class="line">＃ 常用操作</span><br><span class="line">docker inspect 容器名字 ＃ 查看容器的信息</span><br><span class="line">docker attach <span class="comment"># 连接(进入)到一个正在运行的容器</span></span><br><span class="line">docker creeate <span class="comment"># 创建但不运行</span></span><br><span class="line">docker run<span class="comment"># 创建并运行</span></span><br><span class="line">docker top <span class="comment"># 显示容器的进程信息</span></span><br><span class="line">docker cp <span class="comment"># 从容器里向外拷贝文件或目录</span></span><br><span class="line">docker logs <span class="comment"># 查看容器的日志 !! 可以看到其标准（错误）输出</span></span><br><span class="line">docker exec -it 容器名字 bash<span class="comment"># 在容器中创建一个新的bash会话</span></span><br><span class="line"></span><br><span class="line">docker ps -[l|a]</span><br><span class="line">docker start|stop|restart|pause|unpause 容器名字<span class="string">/ID</span></span><br><span class="line">docker rm 容器</span><br><span class="line">docker rmi 镜像</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker build <span class="comment"># 使用Dockerfile创建镜像</span></span><br><span class="line">docker <span class="keyword">history</span> <span class="comment"># 显示生成一个镜像的历史命令</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">示例： 在官方centos7镜像上 安装一个node环境（虽然node也有镜像 但更喜欢自己装）</span><br><span class="line">docker pull centos</span><br><span class="line">docker run -itd <span class="params">--name=</span><span class="string">"cent"</span> -m 512M -p 8080<span class="function">:80</span> -p 9000<span class="function">:9000</span> -v <span class="string">/Users/moran/Documents/angular/</span>:<span class="string">/data/angular</span> centos</span><br><span class="line">docker attach cent</span><br><span class="line"></span><br><span class="line"><span class="comment">#  基础工具</span></span><br><span class="line">yum install wget vim gcc-c++ make -y</span><br><span class="line">yum install gem -y </span><br><span class="line">gem sources <span class="params">--add</span> https:<span class="string">//gems.ruby-china.org/</span> <span class="params">--remove</span> https:<span class="string">//rubygems.org/</span></span><br><span class="line">gem install compass</span><br><span class="line"></span><br><span class="line"><span class="comment">#  install npm</span></span><br><span class="line"><span class="keyword">cd</span> <span class="string">/tmp</span></span><br><span class="line">wget https:<span class="string">//nodejs.org/dist/v6.9.1/node-v6.9.1.tar.gz</span></span><br><span class="line">tar zxvf node-v6.9.1.tar.gz </span><br><span class="line"><span class="keyword">cd</span> node-v6.9.1</span><br><span class="line"><span class="string">./configure</span> </span><br><span class="line">make</span><br><span class="line">make install </span><br><span class="line"></span><br><span class="line"><span class="comment"># tools</span></span><br><span class="line">npm install -g cnpm <span class="params">--registry=https</span>:<span class="string">//registry.npm.taobao.org</span></span><br><span class="line">cnpm install -g grunt-cli </span><br><span class="line">cnpm install -g yo</span><br><span class="line">cnpm install -g bower</span><br><span class="line">cnpm install -g generator-karma</span><br><span class="line">cnpm install -g generator-angular</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存容器</span></span><br><span class="line">docker commit 版本ID 远程仓库</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h5 id=&quot;docker-常用命令&quot;&gt;&lt;a href=&quot;#docker-常用命令&quot; class=&quot;headerlink&quot; title=&quot;docker 常用命令&quot;&gt;&lt;/a&gt;docker 常用命令&lt;/h5&gt;&lt;figure class=&quot;highlight jboss-cli&quot;&gt;&lt;
      
    
    </summary>
    
      <category term="docker" scheme="http://ningmo.github.io/categories/docker/"/>
    
    
      <category term="docker" scheme="http://ningmo.github.io/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>linux-find-grep</title>
    <link href="http://ningmo.github.io/2016/10/25/linux/linux-find-grep/"/>
    <id>http://ningmo.github.io/2016/10/25/linux/linux-find-grep/</id>
    <published>2016-10-25T12:49:04.000Z</published>
    <updated>2021-05-08T01:16:16.000Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">在当前目录下所有文件中查找内容包含 string 的文件:</span><br><span class="line"><span class="builtin-name">find</span> ./ -name <span class="string">"*"</span> -exec grep <span class="string">"string"</span> &#123;&#125; \; </span><br><span class="line">注意:在最后不能加 print,否则会出错</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">在当前目录下所有文件中查找内容包含 string 的文件并列出字符所在的文件:</span><br><span class="line"><span class="builtin-name">find</span> ./ -name <span class="string">"*"</span> -exec grep -l <span class="string">"string"</span> &#123;&#125; \; </span><br><span class="line"> </span><br><span class="line">在当前目录下 *.c 中查找内容包含 string 的文件并列出字符所在的文件的所在行(不显示文件名):</span><br><span class="line"><span class="builtin-name">find</span> ./ -name <span class="string">"*.c"</span> -exec grep -n <span class="string">"string"</span> &#123;&#125; \; </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">在当前目录下所有文件中查找内容包含 string 的文件并列出字符所在的文件,所在行及所在行的内容:</span><br><span class="line"><span class="builtin-name">find</span> ./ -name <span class="string">"*"</span> -exec grep -n <span class="string">"string"</span> ./ &#123;&#125; \; </span><br><span class="line"> </span><br><span class="line">使用 <span class="builtin-name">find</span> 查找时希望忽略某个目录(-prune)：</span><br><span class="line">如果希望在 /app 目录下查找文件， 但不希望在 /app/bin 目录下查找：</span><br><span class="line"><span class="builtin-name">find</span> /app -name <span class="string">"/app/bin"</span> -prune -o -<span class="builtin-name">print</span> </span><br><span class="line"></span><br><span class="line">使用type 选项:</span><br><span class="line">如果要在 /etc 目录下查找所有的目录：</span><br><span class="line"><span class="builtin-name">find</span> /etc -type d -print</span><br><span class="line"></span><br><span class="line">如果要在 /etc 目录下查找 .svn 的目录：</span><br><span class="line"><span class="builtin-name">find</span> /etc -name .svn -type d -<span class="builtin-name">print</span> </span><br><span class="line"></span><br><span class="line">为了在当前目录下查找除目录以外的所有类型的文件：</span><br><span class="line"><span class="builtin-name">find</span> . ! -type d -print</span><br><span class="line"> </span><br><span class="line">为了在当前目录下查找所有的符号链接文件， 可以用：</span><br><span class="line"><span class="builtin-name">find</span> . -type l -print</span><br><span class="line"><span class="builtin-name">find</span> .  -mtime -4（4天内）/4(4天前的那一天)/+4（5天前）</span><br><span class="line"><span class="builtin-name">find</span> .</span><br><span class="line">         -name  *</span><br><span class="line">         -size   +50k</span><br><span class="line">         -type    f/b/c/d/l/sp<span class="built_in">..</span>.</span><br><span class="line">         -perm    -/+ /    755</span><br><span class="line">         -uid<span class="built_in">/user </span>     201/yangsf</span><br><span class="line">         -gid<span class="built_in">/group </span>   501/yangsf</span><br><span class="line">         -nouser/nogroup   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">为了用 ls -l 命令列出所匹配到的文件， 可以把 ls -l 命令放在find命令的 -exec 选项中：</span><br><span class="line"><span class="builtin-name">find</span> . -type f -exec ls -l &#123;&#125; \;</span><br><span class="line">注： f 表示普通文件  exec 选项后面跟随着所要执行的命令， 然后是一对 &#123;&#125;， 一个空格和一个 \，最后是一个分号。</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight routeros&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;在当前目录下所有文件中查找内容包含 string 的文件:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;
      
    
    </summary>
    
      <category term="linux" scheme="http://ningmo.github.io/categories/linux/"/>
    
    
      <category term="find" scheme="http://ningmo.github.io/tags/find/"/>
    
      <category term="grep" scheme="http://ningmo.github.io/tags/grep/"/>
    
  </entry>
  
</feed>
