<!DOCTYPE html>
<html lang>
  <head><meta name="generator" content="Hexo 3.9.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="description" content=".htaccess 规则">








  <link rel="alternate" href="/default" title="追寻一颗宁静的心">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1">



<link rel="canonical" href="http://ningmo.github.io/2012/12/18/htaccess 规则/">


<meta name="description" content=".htaccess 规则  Introduction 介绍文件名 .htaccess 属性 644 (RW-R–R–)htaccess会影响它所在目录下的所有子目录注意大多数内容都要求保持在一行之内，不要换行，否则会引起错误  Error Documents 错误文档Official document: ErrorDocument DirectiveErrorDocument code docum">
<meta property="og:type" content="article">
<meta property="og:title" content=".htaccess 规则">
<meta property="og:url" content="http://ningmo.github.io/2012/12/18/htaccess 规则/index.html">
<meta property="og:site_name" content="追寻一颗宁静的心">
<meta property="og:description" content=".htaccess 规则  Introduction 介绍文件名 .htaccess 属性 644 (RW-R–R–)htaccess会影响它所在目录下的所有子目录注意大多数内容都要求保持在一行之内，不要换行，否则会引起错误  Error Documents 错误文档Official document: ErrorDocument DirectiveErrorDocument code docum">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-08-23T09:24:57.163Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content=".htaccess 规则">
<meta name="twitter:description" content=".htaccess 规则  Introduction 介绍文件名 .htaccess 属性 644 (RW-R–R–)htaccess会影响它所在目录下的所有子目录注意大多数内容都要求保持在一行之内，不要换行，否则会引起错误  Error Documents 错误文档Official document: ErrorDocument DirectiveErrorDocument code docum">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1">
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  



    <title> .htaccess 规则 - 追寻一颗宁静的心 </title>
  </head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">追寻一颗宁静的心</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          .htaccess 规则
        
      </h1>

      <time class="post-time">
          Dec 18 2012
      </time>
    </header>



    
            <div class="post-content">
            <p>.htaccess 规则</p>
<ol>
<li><p>Introduction 介绍<br>文件名 .htaccess 属性 644 (RW-R–R–)<br>htaccess会影响它所在目录下的所有子目录<br>注意大多数内容都要求保持在一行之内，不要换行，否则会引起错误</p>
</li>
<li><p>Error Documents 错误文档<br>Official document: ErrorDocument Directive<br>ErrorDocument code document<br>例子<br>ErrorDocument 400 /errors/badrequest.html<br>ErrorDocument 404 <a href="http://yoursite/errors/notfound.html" target="_blank" rel="noopener">http://yoursite/errors/notfound.html</a><br>ErrorDocument 401 “Authorization Required”</p>
</li>
</ol>
<p>more..<br>less.. (注意之后内容如果出现的双引号需要转义为 ”)<br>常见HTTP状态码<br>Successful Client Requests<br>200 OK<br>201 Created<br>202 Accepted<br>203 Non-Authorative Information<br>204 No Content<br>205 Reset Content<br>206 Partial Content<br>Client Request Redirected<br>300 Multiple Choices<br>301 Moved Permanently<br>302 Moved Temporarily<br>303 See Other<br>304 Not Modified<br>305 Use Proxy<br>Client Request Errors<br>400 Bad Request<br>401 Authorization Required<br>402 Payment Required (not used yet)<br>403 Forbidden<br>404 Not Found<br>405 Method Not Allowed<br>406 Not Acceptable (encoding)<br>407 Proxy Authentication Required<br>408 Request Timed Out<br>409 Conflicting Request<br>410 Gone<br>411 Content Length Required<br>412 Precondition Failed<br>413 Request Entity Too Long<br>414 Request URI Too Long<br>415 Unsupported Media Type<br>Server Errors<br>500 Internal Server Error<br>501 Not Implemented<br>502 Bad Gateway<br>503 Service Unavailable<br>504 Gateway Timeout<br>505 HTTP Version Not Supported</p>
<ol start="3">
<li><p>Password Protection 密码保护<br>Official document: Authentication, Authorization and Access Control<br>假设密码文件为.htpasswd<br>AuthUserFile /usr/local/safedir/.htpasswd (这里必须使用全路径名)<br>AuthName EnterPassword<br>AuthType Basic<br>两种常见验证方式:<br>Require user windix<br>(仅允许用户windix登陆)<br>Require valid-user<br>(所有合法用户都可登陆)<br>Tip: 如何生成密码文件<br>使用htpasswd命令(apache自带)<br>第一次生成需要创建密码文件<br>htpasswd -c .htpasswd user1<br>之后增加新用户<br>htpasswd .htpasswd user2</p>
</li>
<li><p>Enabling SSI Via htaccess 通过htaccess允许SSI(Server Side Including)功能<br>AddType text/html .shtml<br>AddHandler server-parsed .shtml<br>Options Indexes FollowSymLinks Includes<br>DirectoryIndex index.shtml index.html</p>
</li>
<li><p>Blocking users by IP 根据IP阻止用户访问<br>order allow,deny<br>deny from 123.45.6.7<br>deny from 12.34.5. (整个C类地址)<br>allow from all</p>
</li>
<li><p>Blocking users/sites by referrer 根据referrer阻止用户/站点访问<br>需要mod_rewrite模块<br>例1. 阻止单一referrer: badsite.com<br>RewriteEngine on</p>
<h1 id="Options-FollowSymlinks"><a href="#Options-FollowSymlinks" class="headerlink" title="Options +FollowSymlinks"></a>Options +FollowSymlinks</h1><p>RewriteCond %{HTTP_REFERER} badsite.com [NC]<br>RewriteRule .* - [F]<br>例2. 阻止多个referrer: badsite1.com, badsite2.com<br>RewriteEngine on</p>
<h1 id="Options-FollowSymlinks-1"><a href="#Options-FollowSymlinks-1" class="headerlink" title="Options +FollowSymlinks"></a>Options +FollowSymlinks</h1><p>RewriteCond %{HTTP_REFERER} badsite1.com [NC,OR]<br>RewriteCond %{HTTP_REFERER} badsite2.com<br>RewriteRule .* - [F]<br>[NC] - 大小写不敏感(Case-insensite)<br>[F] - 403 Forbidden<br>注意以上代码注释掉了”Options +FollowSymlinks”这个语句。如果服务器未在 httpd.conf 的 段落设置 FollowSymLinks, 则需要加上这句，否则会得到”500 Internal Server error”错误。</p>
</li>
<li><p>Blocking bad bots and site rippers (aka offline browsers) 阻止坏爬虫和离线浏览器<br>需要mod_rewrite模块<br>坏爬虫? 比如一些抓垃圾email地址的爬虫和不遵守robots.txt的爬虫(如baidu?)<br>可以根据 HTTP_USER_AGENT 来判断它们<br>(但是还有更无耻的如”中搜 zhongsou.com”之流把自己的agent设置为 “Mozilla/4.0 (compatible; MSIE 5.5; Windows NT 5.0)” 太流氓了，就无能为力了)<br>RewriteEngine On<br>RewriteCond %{HTTP_USER_AGENT} ^BlackWidow [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Bot mailto:<a href="mailto:craftbot@yahoo.com" target="_blank" rel="noopener">craftbot@yahoo.com</a> [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^ChinaClaw [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Custo [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^DISCo [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Download Demon [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^eCatch [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^EirGrabber [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^EmailSiphon [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^EmailWolf [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Express WebPictures [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^ExtractorPro [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^EyeNetIE [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^FlashGet [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^GetRight [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^GetWeb! [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Go!Zilla [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Go-Ahead-Got-It [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^GrabNet [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Grafula [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^HMView [OR]<br>RewriteCond %{HTTP_USER_AGENT} HTTrack [NC,OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Image Stripper [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Image Sucker [OR]<br>RewriteCond %{HTTP_USER_AGENT} Indy Library [NC,OR]<br>RewriteCond %{HTTP_USER_AGENT} ^InterGET [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Internet Ninja [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^JetCar [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^JOC Web Spider [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^larbin [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^LeechFTP [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Mass Downloader [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^MIDown tool [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Mister PiX [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Navroad [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^NearSite [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^NetAnts [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^NetSpider [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Net Vampire [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^NetZIP [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Octopus [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Offline Explorer [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Offline Navigator [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^PageGrabber [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Papa Foto [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^pavuk [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^pcBrowser [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^RealDownload [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^ReGet [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^SiteSnagger [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^SmartDownload [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^SuperBot [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^SuperHTTP [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Surfbot [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^tAkeOut [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Teleport Pro [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^VoidEYE [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Web Image Collector [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Web Sucker [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^WebAuto [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^WebCopier [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^WebFetch [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^WebGo IS [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^WebLeacher [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^WebReaper [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^WebSauger [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Website eXtractor [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Website Quester [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^WebStripper [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^WebWhacker [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^WebZIP [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Wget [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Widow [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^WWWOFFLE [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Xaldon WebSpider [OR]<br>RewriteCond %{HTTP_USER_AGENT} ^Zeus<br>RewriteRule ^.* - [F,L]<br>[F] - 403 Forbidden<br>[L] - ?</p>
</li>
<li><p>Change your default directory page 改变缺省目录页面<br>DirectoryIndex index.html index.php index.cgi index.pl</p>
</li>
<li><p>Redirects 转向<br>单个文件<br>Redirect /old_dir/old_file.html <a href="http://yoursite.com/new_dir/new_file.html" target="_blank" rel="noopener">http://yoursite.com/new_dir/new_file.html</a><br>整个目录<br>Redirect /old_dir <a href="http://yoursite.com/new_dir" target="_blank" rel="noopener">http://yoursite.com/new_dir</a><br>效果: 如同将目录移动位置一样<br>[url]<a href="http://yoursite.com/old_dir" target="_blank" rel="noopener">http://yoursite.com/old_dir</a> -&gt; <a href="http://yoursite.com/new_dir[/url]" target="_blank" rel="noopener">http://yoursite.com/new_dir[/url]</a><br>[url]<a href="http://yoursite.com/old_dir/dir1/test.html" target="_blank" rel="noopener">http://yoursite.com/old_dir/dir1/test.html</a> -&gt; <a href="http://yoursite.com/new_dir/dir1/test.html[/url]" target="_blank" rel="noopener">http://yoursite.com/new_dir/dir1/test.html[/url]</a><br>Tip: 使用用户目录时Redirect不能转向的解决方法<br>当你使用Apache默认的用户目录，如 <a href="http://mysite.com/~windix，当你想转向" target="_blank" rel="noopener">http://mysite.com/~windix，当你想转向</a> <a href="http://mysite.com/~windix/jump时，你会发现下面这个Redirect不工作" target="_blank" rel="noopener">http://mysite.com/~windix/jump时，你会发现下面这个Redirect不工作</a>:<br>Redirect /jump <a href="http://www.google.com" target="_blank" rel="noopener">http://www.google.com</a><br>正确的方法是改成<br>Redirect /~windix/jump <a href="http://www.google.com" target="_blank" rel="noopener">http://www.google.com</a><br>(source: .htaccess Redirect in “Sites” not redirecting: why?<br>)</p>
</li>
<li><p>Prevent viewing of .htaccess file 防止.htaccess文件被查看<br>order allow,deny<br>deny from all</p>
</li>
<li><p>Adding MIME Types 添加 MIME 类型<br>AddType application/x-shockwave-flash swf<br>Tips: 设置类型为 application/octet-stream 将提示下载</p>
</li>
<li><p>Preventing hot linking of images and other file types 防盗链<br>需要mod_rewrite模块<br>RewriteEngine on<br>RewriteCond %{HTTP_REFERER} !^$<br>RewriteCond %{HTTP_REFERER} !^http://(www/.)?mydomain.com/.*$ [NC]<br>RewriteRule .(gif|jpg|js|css)$ - [F]<br>解析:<br>若 HTTP_REFERER 非空 (来源为其他站点，非直接连接) 并且<br>若 HTTP_REFERER 非(www.)mydomain.com开头(忽略大小写[NC]) (来源非本站)<br>对于所有含有 .gif/.jpg/.js/.css 结尾的文件给出 403 Forbidden 错误[F]<br>也可指定响应，如下例显示替换图片<br>RewriteRule .(gif|jpg)$<br>[R,L]<br>[R] - 转向(Redirect)<br>[L] - 连接(Link)</p>
</li>
</ol>

            </div>
          

    
      <footer class="post-footer">
		

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2012/12/18/apache .htaccess 规则/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">apache .htaccess 规则</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2012/12/18/HTACCESS规则教程/">
        <span class="next-text nav-default">.HTACCESS规则教程</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2014 -
    
    2019
    <span class="footer-author">ningmo.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a> and <a class="theme-link" href="https://github.com/frostfan/hexo-theme-polarbear">Polar Bear</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
